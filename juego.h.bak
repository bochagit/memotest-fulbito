/**
 * @file juego.h
 * @author Maranzana, Rodrigo Ezequiel
 * @brief Este modulo contiene la logica principal del juego.
 * * * Este modulo define la estructura central del juego 'tJuego' y gestiona
 * el loop del mismo, integrando todos los demas modulos.
 *
 * @version 1.0
 * @date 2026-02-02
 */

#ifndef JUEGO_H_INCLUDED
#define JUEGO_H_INCLUDED

#include <SDL2/SDL.h>
#include <SDL2/SDL_mixer.h>
#include <SDL2/SDL_ttf.h>
#include <stdint.h>
#include "hud.h"
#include "sonidos.h"
#include "memoria.h"

#define LOOP_DELAY 16 // Ms

/**
 * @brief Enumeracion con las capas de renderizado.
 */
typedef enum {
    FB_BACKGROUND,  // Fondo estatico
    FB_ESCENA,      // Escena dinamica (sprites)
    FB_HUD,         // Interfaz del usuario (HUD)
    FB_CANT,
}eFramebuffers;

typedef enum {
    FANTASMA_NARANJA,
    FANTASMA_VERDE,
    FANTASMA_ROSA,
    FANTASMA_ROJO,
    FANTASMA_AZUL,
    FANTASMA_CANT,
}eFantasmas;

/**
 * @brief Estructura principal del juego que contiene el estado del mismo y sus recursos (contexto).
 */
typedef struct {
    SDL_Window *ventana;                    // Puntero a la ventana
    SDL_Renderer *renderer;                 // Puntero al renderizador de SDL
    SDL_Texture *framebuffers[FB_CANT];     // Array de framebuffers/capas para la composicion
    SDL_Texture *background;                // Textura utilizada como fondo
    SDL_Surface *fantasmas[FANTASMA_CANT];  // Superficies en RAM de las imagenes de los fantasmas
    SDL_Texture *textoBotones;              // Textura generada con TTF para la interfaz de usuario
    SDL_Point textoBotonesCoords;           // Coordenadas para el dibujo de la textura anterior
    uint8_t fantasmaActual;                 // Indice del fantasma mostrado
    TTF_Font *fuenteTTF;                    // Fuente cargada para la generacion de textos
    tSonido *sonido;                        // Sonido cargado desde el disco
    tSonido *melodia;                       // Sonido cargado desde el disco
    tSonido *tono;                          // Tono generado
    uint32_t anchoVentana;                  // Dimension horizontal de la ventana
    uint32_t altoVentana;                   // Dimension vertical  de la ventana
    uint8_t audioInicializado;              // Bandera de control de SDL_Mixer
    tHUD *contadorClics;                    // Instancia del HUD para contador de clics
    tHUD *indicador;                        // Instancia del HUD para indicador visuales (fantasma)
    uint8_t corriendo;                      // Bandera de control de estado del game loop.
    char nombreJugador[32];                 // Nombre del jugador ingresado en la presentaci√≥n
    tMemoria *partida;                       // Puntero a la partida de memoria
} tJuego;

/**
 * @brief Inicializa todos los subsistemas y carga los recursos iniciales en el contexto del juego.
 *
 * @param juego Puntero a la estructura tJuego a inicializar.
 *
 * @return tError TODO_OK o el codigo de error correspondiente al fallo.
 */
tError juego_inicializar(tJuego *juego);

/**
 * @brief Captura y procesa las entradas del usuario.
 *
 * @param juego Puntero al contexto del juego.
 *
 * @return tError TODO_OK o el codigo de error correspondiente al fallo.
 */
tError juego_procesar_eventos(tJuego *juego);

/**
 * @brief Actualiza la logica del juego.
 *
 * @param juego Puntero al contexto del juego.
 */
void juego_actualizar(tJuego *juego);

/**
 * @brief Gestiona el orden de llamado a las funciones de los modulos correspondientes al renderizado.
 *
 * @param juego Puntero al contexto del juego.
 */
void juego_renderizar(tJuego *juego);

/**
 * @brief Libera la totalidad de los recursos del juego.
 *
 * @param juego Puntero al contexto a destruir.
 */
void juego_destruir(tJuego *juego);

#endif // JUEGO_H_INCLUDED
